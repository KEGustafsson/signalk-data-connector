/*! For license information please see main.a04177006a90d848c0de.js.LICENSE.txt */
(()=>{"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(){var t,i,s="function"==typeof Symbol?Symbol:{},r=s.iterator||"@@iterator",a=s.toStringTag||"@@toStringTag";function o(n,s,r,a){var o=s&&s.prototype instanceof u?s:u,d=Object.create(o.prototype);return e(d,"_invoke",function(n,e,s){var r,a,o,u=0,d=s||[],l=!1,v={p:0,n:0,v:t,a:f,f:f.bind(t,4),d:function(n,e){return r=n,a=0,o=t,v.n=e,c}};function f(n,e){for(a=n,o=e,i=0;!l&&u&&!s&&i<d.length;i++){var s,r=d[i],f=v.p,p=r[2];n>3?(s=p===e)&&(o=r[(a=r[4])?5:(a=3,3)],r[4]=r[5]=t):r[0]<=f&&((s=n<2&&f<r[1])?(a=0,v.v=e,v.n=r[1]):f<p&&(s=n<3||r[0]>e||e>p)&&(r[4]=n,r[5]=e,v.n=p,a=0))}if(s||n>1)return c;throw l=!0,e}return function(s,d,p){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&f(d,p),a=d,o=p;(i=a<2?t:o)||!l;){r||(a?a<3?(a>1&&(v.n=-1),f(a,o)):v.n=o:v.v=o);try{if(u=2,r){if(a||(s="next"),i=r[s]){if(!(i=i.call(r,o)))throw TypeError("iterator result is not an object");if(!i.done)return i;o=i.value,a<2&&(a=0)}else 1===a&&(i=r.return)&&i.call(r),a<2&&(o=TypeError("The iterator does not provide a '"+s+"' method"),a=1);r=t}else if((i=(l=v.n<0)?o:n.call(e,v))!==c)break}catch(n){r=t,a=1,o=n}finally{u=1}}return{value:i,done:l}}}(n,r,a),!0),d}var c={};function u(){}function d(){}function l(){}i=Object.getPrototypeOf;var v=[][r]?i(i([][r]())):(e(i={},r,function(){return this}),i),f=l.prototype=u.prototype=Object.create(v);function p(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,e(t,a,"GeneratorFunction")),t.prototype=Object.create(f),t}return d.prototype=l,e(f,"constructor",l),e(l,"constructor",d),d.displayName="GeneratorFunction",e(l,a,"GeneratorFunction"),e(f),e(f,a,"Generator"),e(f,r,function(){return this}),e(f,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:p}})()}function e(t,n,i,s){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}e=function(t,n,i,s){function a(n,i){e(t,n,function(t){return this._invoke(n,i,t)})}n?r?r(t,n,{value:i,enumerable:!s,configurable:!s,writable:!s}):t[n]=i:(a("next",0),a("throw",1),a("return",2))},e(t,n,i,s)}function i(t,n,e,i,s,r,a){try{var o=t[r](a),c=o.value}catch(t){return void e(t)}o.done?n(c):Promise.resolve(c).then(i,s)}function s(t){return function(){var n=this,e=arguments;return new Promise(function(s,r){var a=t.apply(n,e);function o(t){i(a,s,r,o,c,"next",t)}function c(t){i(a,s,r,o,c,"throw",t)}o(void 0)})}}function r(t,n){for(var e=0;e<n.length;e++){var i=n[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,a(i.key),i)}}function a(n){var e=function(n){if("object"!=t(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var i=e.call(n,"string");if("object"!=t(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==t(e)?e:e+""}var o=function(){return t=function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.deltaTimerConfig=null,this.subscriptionConfig=null,this.isServerMode=!1,this.metricsInterval=null,this.init()},e=[{key:"init",value:(d=s(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.checkServerMode();case 1:if(!this.isServerMode){t.n=3;break}return this.showServerModeUI(),t.n=2,this.loadMetrics();case 2:this.startMetricsRefresh(),t.n=6;break;case 3:return t.n=4,this.loadConfigurations();case 4:return this.setupEventListeners(),this.updateUI(),this.updateStatus(),t.n=5,this.loadMetrics();case 5:this.startMetricsRefresh();case 6:t.n=8;break;case 7:t.p=7,e=t.v,console.error("Initialization error:",e),this.showNotification("Failed to initialize application: "+e.message,"error");case 8:return t.a(2)}},t,this,[[0,7]])})),function(){return d.apply(this,arguments)})},{key:"checkServerMode",value:(u=s(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:e=t.v,this.isServerMode=!e.ok&&(404===e.status||405===e.status),t.n=3;break;case 2:t.p=2,t.v,this.isServerMode=!0;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"loadConfigurations",value:(c=s(n().m(function t(){var e,i,s;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:return e=t.v,t.n=2,e.json();case 2:return this.deltaTimerConfig=t.v,t.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json");case 3:return i=t.v,t.n=4,i.json();case 4:this.subscriptionConfig=t.v,t.n=6;break;case 5:t.p=5,s=t.v,this.showNotification("Error loading configurations: "+s.message,"error");case 6:return t.a(2)}},t,this,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var t=this;document.getElementById("saveDeltaTimer").addEventListener("click",function(){t.saveDeltaTimer()}),document.getElementById("saveSubscription").addEventListener("click",function(){t.saveSubscription()}),document.getElementById("addPath").addEventListener("click",function(){t.addPathItem()}),document.getElementById("subscriptionJson").addEventListener("input",function(){t.syncFromJson()}),document.getElementById("context").addEventListener("input",function(){t.updateJsonFromForm()})}},{key:"updateUI",value:function(){var t=this;this.deltaTimerConfig&&this.deltaTimerConfig.deltaTimer&&(document.getElementById("deltaTimer").value=this.deltaTimerConfig.deltaTimer),this.subscriptionConfig&&(document.getElementById("context").value=this.subscriptionConfig.context||"*",document.getElementById("pathsList").innerHTML="",this.subscriptionConfig.subscribe&&Array.isArray(this.subscriptionConfig.subscribe)&&this.subscriptionConfig.subscribe.forEach(function(n){t.addPathItem(n.path)}),document.getElementById("subscriptionJson").value=JSON.stringify(this.subscriptionConfig,null,2))}},{key:"addPathItem",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=document.getElementById("pathsList"),i=document.createElement("div");i.className="path-item";var s=document.createElement("input");s.type="text",s.value=n,s.placeholder="navigation.position",s.className="path-input";var r=document.createElement("button");r.type="button",r.className="btn btn-danger",r.textContent="Remove",s.addEventListener("input",function(){t.updateJsonFromForm()}),r.addEventListener("click",function(){i.remove(),t.updateJsonFromForm()}),i.appendChild(s),i.appendChild(r),e.appendChild(i),this.updateJsonFromForm()}},{key:"updateJsonFromForm",value:function(){var t=document.getElementById("context").value||"*",n=document.querySelectorAll(".path-input"),e={context:t,subscribe:Array.from(n).map(function(t){return{path:t.value}}).filter(function(t){return""!==t.path.trim()})};document.getElementById("subscriptionJson").value=JSON.stringify(e,null,2)}},{key:"syncFromJson",value:function(){var t=this;try{var n=document.getElementById("subscriptionJson").value,e=JSON.parse(n);document.getElementById("context").value=e.context||"*",document.getElementById("pathsList").innerHTML="",e.subscribe&&Array.isArray(e.subscribe)&&e.subscribe.forEach(function(n){t.addPathItem(n.path||"")})}catch(t){console.warn("Invalid JSON in editor:",t.message)}}},{key:"saveDeltaTimer",value:(o=s(n().m(function t(){var e,i,s;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=parseInt(document.getElementById("deltaTimer").value),!(isNaN(e)||e<100||e>1e4)){t.n=1;break}return this.showNotification("Delta timer must be between ".concat(100," and ").concat(1e4," milliseconds"),"error"),t.a(2);case 1:return i={deltaTimer:e},t.p=2,t.n=3,fetch("/plugins/signalk-data-connector/config/delta_timer.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 3:if(!t.v.ok){t.n=4;break}this.deltaTimerConfig=i,this.showNotification("Delta timer configuration saved successfully!","success"),this.updateStatus(),t.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:t.n=7;break;case 6:t.p=6,s=t.v,this.showNotification("Error saving delta timer: "+s.message,"error");case 7:return t.a(2)}},t,this,[[2,6]])})),function(){return o.apply(this,arguments)})},{key:"saveSubscription",value:(a=s(n().m(function t(){var e,i,s;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=document.getElementById("subscriptionJson").value,(i=JSON.parse(e)).context){t.n=1;break}throw new Error("Context is required");case 1:if(i.subscribe&&Array.isArray(i.subscribe)){t.n=2;break}throw new Error("Subscribe array is required");case 2:return t.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 3:if(!t.v.ok){t.n=4;break}this.subscriptionConfig=i,this.showNotification("Subscription configuration saved successfully!","success"),this.updateStatus(),t.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:t.n=7;break;case 6:t.p=6,s=t.v,this.showNotification("Error saving subscription: "+s.message,"error");case 7:return t.a(2)}},t,this,[[0,6]])})),function(){return a.apply(this,arguments)})},{key:"loadMetrics",value:(i=s(n().m(function t(){var e,i,s;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/metrics");case 1:if(!(e=t.v).ok){t.n=3;break}return t.n=2,e.json();case 2:i=t.v,this.updateMetricsDisplay(i);case 3:t.n=5;break;case 4:t.p=4,s=t.v,console.error("Error loading metrics:",s.message);case 5:return t.a(2)}},t,this,[[0,4]])})),function(){return i.apply(this,arguments)})},{key:"startMetricsRefresh",value:function(){var t=this;this.metricsInterval&&clearInterval(this.metricsInterval),this.metricsInterval=setInterval(function(){t.loadMetrics()},5e3)}},{key:"updateMetricsDisplay",value:function(t){var n=document.getElementById("metrics");if(n){var e=t.stats.udpSendErrors>0||t.stats.compressionErrors>0||t.stats.encryptionErrors>0||t.stats.subscriptionErrors>0,i='\n      <h4>üìä Performance Metrics</h4>\n      <div class="metrics-grid">\n        <div class="metric-item">\n          <div class="metric-label">Uptime</div>\n          <div class="metric-value">'.concat(t.uptime.formatted,'</div>\n        </div>\n        <div class="metric-item">\n          <div class="metric-label">Mode</div>\n          <div class="metric-value">').concat("server"===t.mode?"üñ•Ô∏è Server":"üì± Client",'</div>\n        </div>\n        <div class="metric-item ').concat(t.status.readyToSend?"success":"error",'">\n          <div class="metric-label">Status</div>\n          <div class="metric-value">').concat(t.status.readyToSend?"‚úì Ready":"‚úó Not Ready","</div>\n        </div>\n        ").concat("client"===t.mode?'\n        <div class="metric-item">\n          <div class="metric-label">Buffered Deltas</div>\n          <div class="metric-value">'.concat(t.status.deltasBuffered,"</div>\n        </div>\n        "):"",'\n      </div>\n\n      <div class="metrics-stats">\n        <h5>Transmission Statistics</h5>\n        <div class="stats-grid">\n          ').concat("client"===t.mode?'\n          <div class="stat-item">\n            <span class="stat-label">Deltas Sent:</span>\n            <span class="stat-value">'.concat(t.stats.deltasSent.toLocaleString(),"</span>\n          </div>\n          "):"","\n          ").concat("server"===t.mode?'\n          <div class="stat-item">\n            <span class="stat-label">Deltas Received:</span>\n            <span class="stat-value">'.concat(t.stats.deltasReceived.toLocaleString(),"</span>\n          </div>\n          "):"","\n          ").concat("client"===t.mode?'\n          <div class="stat-item '.concat(t.stats.udpSendErrors>0?"error":"",'">\n            <span class="stat-label">UDP Send Errors:</span>\n            <span class="stat-value">').concat(t.stats.udpSendErrors,'</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">UDP Retries:</span>\n            <span class="stat-value">').concat(t.stats.udpRetries,"</span>\n          </div>\n          "):"",'\n          <div class="stat-item ').concat(t.stats.compressionErrors>0?"error":"",'">\n            <span class="stat-label">Compression Errors:</span>\n            <span class="stat-value">').concat(t.stats.compressionErrors,'</span>\n          </div>\n          <div class="stat-item ').concat(t.stats.encryptionErrors>0?"error":"",'">\n            <span class="stat-label">Encryption Errors:</span>\n            <span class="stat-value">').concat(t.stats.encryptionErrors,"</span>\n          </div>\n          ").concat("client"===t.mode?'\n          <div class="stat-item '.concat(t.stats.subscriptionErrors>0?"error":"",'">\n            <span class="stat-label">Subscription Errors:</span>\n            <span class="stat-value">').concat(t.stats.subscriptionErrors,"</span>\n          </div>\n          "):"","\n        </div>\n      </div>\n    ");if(t.lastError){var s=t.lastError.timeAgo,r=s<6e4?"".concat(Math.floor(s/1e3),"s ago"):"".concat(Math.floor(s/6e4),"m ago");i+='\n        <div class="metrics-error">\n          <h5>‚ö†Ô∏è Last Error</h5>\n          <div class="error-message">'.concat(this.escapeHtml(t.lastError.message),'</div>\n          <div class="error-time">Occurred ').concat(r,"</div>\n        </div>\n      ")}else e||(i+='\n        <div class="metrics-success">\n          <div class="success-message">‚úì No errors detected</div>\n        </div>\n      ');n.innerHTML=i}}},{key:"escapeHtml",value:function(t){var n=document.createElement("div");return n.textContent=t,n.innerHTML}},{key:"updateStatus",value:function(){var t=document.getElementById("status"),n="<h4>Configuration Status</h4>";if(this.deltaTimerConfig?n+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> '.concat(this.deltaTimerConfig.deltaTimer,'ms\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n            '):n+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ',this.subscriptionConfig&&this.subscriptionConfig.subscribe){var e=this.subscriptionConfig.subscribe.length;n+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> '.concat(e,' path(s) configured\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n                <div class="status-details">\n                    <strong>Context:</strong> ').concat(this.subscriptionConfig.context,"<br>\n                    <strong>Paths:</strong> ").concat(this.subscriptionConfig.subscribe.map(function(t){return t.path}).join(", "),"\n                </div>\n            ")}else n+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ';t.innerHTML=n}},{key:"showServerModeUI",value:function(){document.querySelector(".container").innerHTML='\n            <div class="config-section">\n                <div class="card server-mode-card">\n                    <div class="card-header">\n                        <h2>üñ•Ô∏è Server Mode Active</h2>\n                        <p>This plugin is running in Server Mode</p>\n                    </div>\n                    <div class="card-content">\n                        <div class="server-mode-info">\n                            <h3>Server Mode Information</h3>\n                            <p>This SignalK Data Connector instance is configured to <strong>receive encrypted data</strong> from client devices.</p>\n                            \n                            <div class="info-grid">\n                                <div class="info-item">\n                                    <h4>üîß Configuration</h4>\n                                    <p>Server mode configuration is managed through the SignalK server plugin settings. No additional webapp configuration is required.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üì° Network</h4>\n                                    <p>The server is listening for encrypted UDP data transmissions from client devices on the configured port.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üîê Security</h4>\n                                    <p>All incoming data is automatically decrypted using the configured secret key and integrated into the SignalK data stream.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üìä Data Flow</h4>\n                                    <p><strong>Client Devices ‚Üí Server (This Instance) ‚Üí SignalK Data Stream</strong></p>\n                                </div>\n                            </div>\n\n                            <div class="server-status">\n                                <h4>Current Status</h4>\n                                <div class="status-indicator success">‚úì Server is active and listening for client connections</div>\n                            </div>\n\n                            <div id="metrics" class="metrics-section"></div>\n\n                            <div class="configuration-note">\n                                <h4>üí° Need to Configure?</h4>\n                                <p>To modify server settings (UDP port, encryption key, etc.), use the SignalK server\'s plugin configuration interface:</p>\n                                <ol>\n                                    <li>Go to SignalK Admin Panel</li>\n                                    <li>Navigate to Plugin Config</li>\n                                    <li>Find "Signal K Data Connector"</li>\n                                    <li>Adjust settings as needed</li>\n                                </ol>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}},{key:"showNotification",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",e=document.getElementById("notification");e.textContent=t,e.className="notification ".concat(n," show"),setTimeout(function(){e.classList.remove("show")},4e3)}}],e&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,i,a,o,c,u,d}();document.addEventListener("DOMContentLoaded",function(){window.dataConnectorConfig=new o}),document.addEventListener("visibilitychange",function(){document.hidden&&window.dataConnectorConfig&&window.dataConnectorConfig.metricsInterval?(clearInterval(window.dataConnectorConfig.metricsInterval),window.dataConnectorConfig.metricsInterval=null):document.hidden||!window.dataConnectorConfig||window.dataConnectorConfig.metricsInterval||window.dataConnectorConfig.startMetricsRefresh()}),window.addEventListener("beforeunload",function(){window.dataConnectorConfig&&window.dataConnectorConfig.metricsInterval&&(clearInterval(window.dataConnectorConfig.metricsInterval),window.dataConnectorConfig.metricsInterval=null)})})();
//# sourceMappingURL=main.a04177006a90d848c0de.js.map
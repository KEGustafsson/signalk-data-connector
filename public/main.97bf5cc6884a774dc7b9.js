/*! For license information please see main.97bf5cc6884a774dc7b9.js.LICENSE.txt */
(()=>{"use strict";function n(t){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(n){return typeof n}:function(n){return n&&"function"==typeof Symbol&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n},n(t)}function t(){var n,i,r="function"==typeof Symbol?Symbol:{},o=r.iterator||"@@iterator",s=r.toStringTag||"@@toStringTag";function a(t,r,o,s){var a=r&&r.prototype instanceof u?r:u,d=Object.create(a.prototype);return e(d,"_invoke",function(t,e,r){var o,s,a,u=0,d=r||[],l=!1,f={p:0,n:0,v:n,a:p,f:p.bind(n,4),d:function(t,e){return o=t,s=0,a=n,f.n=e,c}};function p(t,e){for(s=t,a=e,i=0;!l&&u&&!r&&i<d.length;i++){var r,o=d[i],p=f.p,v=o[2];t>3?(r=v===e)&&(a=o[(s=o[4])?5:(s=3,3)],o[4]=o[5]=n):o[0]<=p&&((r=t<2&&p<o[1])?(s=0,f.v=e,f.n=o[1]):p<v&&(r=t<3||o[0]>e||e>v)&&(o[4]=t,o[5]=e,f.n=v,s=0))}if(r||t>1)return c;throw l=!0,e}return function(r,d,v){if(u>1)throw TypeError("Generator is already running");for(l&&1===d&&p(d,v),s=d,a=v;(i=s<2?n:a)||!l;){o||(s?s<3?(s>1&&(f.n=-1),p(s,a)):f.n=a:f.v=a);try{if(u=2,o){if(s||(r="next"),i=o[r]){if(!(i=i.call(o,a)))throw TypeError("iterator result is not an object");if(!i.done)return i;a=i.value,s<2&&(s=0)}else 1===s&&(i=o.return)&&i.call(o),s<2&&(a=TypeError("The iterator does not provide a '"+r+"' method"),s=1);o=n}else if((i=(l=f.n<0)?a:t.call(e,f))!==c)break}catch(t){o=n,s=1,a=t}finally{u=1}}return{value:i,done:l}}}(t,o,s),!0),d}var c={};function u(){}function d(){}function l(){}i=Object.getPrototypeOf;var f=[][o]?i(i([][o]())):(e(i={},o,function(){return this}),i),p=l.prototype=u.prototype=Object.create(f);function v(n){return Object.setPrototypeOf?Object.setPrototypeOf(n,l):(n.__proto__=l,e(n,s,"GeneratorFunction")),n.prototype=Object.create(p),n}return d.prototype=l,e(p,"constructor",l),e(l,"constructor",d),d.displayName="GeneratorFunction",e(l,s,"GeneratorFunction"),e(p),e(p,s,"Generator"),e(p,o,function(){return this}),e(p,"toString",function(){return"[object Generator]"}),(t=function(){return{w:a,m:v}})()}function e(n,t,i,r){var o=Object.defineProperty;try{o({},"",{})}catch(n){o=0}e=function(n,t,i,r){function s(t,i){e(n,t,function(n){return this._invoke(t,i,n)})}t?o?o(n,t,{value:i,enumerable:!r,configurable:!r,writable:!r}):n[t]=i:(s("next",0),s("throw",1),s("return",2))},e(n,t,i,r)}function i(n,t,e,i,r,o,s){try{var a=n[o](s),c=a.value}catch(n){return void e(n)}a.done?t(c):Promise.resolve(c).then(i,r)}function r(n){return function(){var t=this,e=arguments;return new Promise(function(r,o){var s=n.apply(t,e);function a(n){i(s,r,o,a,c,"next",n)}function c(n){i(s,r,o,a,c,"throw",n)}a(void 0)})}}function o(n,t){for(var e=0;e<t.length;e++){var i=t[e];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(n,s(i.key),i)}}function s(t){var e=function(t){if("object"!=n(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==n(e)?e:e+""}var a=function(){return n=function n(){!function(n,t){if(!(n instanceof t))throw new TypeError("Cannot call a class as a function")}(this,n),this.deltaTimerConfig=null,this.subscriptionConfig=null,this.isServerMode=!1,this.init()},e=[{key:"init",value:(u=r(t().m(function n(){return t().w(function(n){for(;;)switch(n.n){case 0:return n.n=1,this.checkServerMode();case 1:if(!this.isServerMode){n.n=2;break}this.showServerModeUI(),n.n=4;break;case 2:return n.n=3,this.loadConfigurations();case 3:this.setupEventListeners(),this.updateUI(),this.updateStatus();case 4:return n.a(2)}},n,this)})),function(){return u.apply(this,arguments)})},{key:"checkServerMode",value:(c=r(t().m(function n(){var e;return t().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:e=n.v,this.isServerMode=!e.ok&&(404===e.status||405===e.status),n.n=3;break;case 2:n.p=2,n.v,this.isServerMode=!0;case 3:return n.a(2)}},n,this,[[0,2]])})),function(){return c.apply(this,arguments)})},{key:"loadConfigurations",value:(a=r(t().m(function n(){var e,i,r;return t().w(function(n){for(;;)switch(n.p=n.n){case 0:return n.p=0,n.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:return e=n.v,n.n=2,e.json();case 2:return this.deltaTimerConfig=n.v,n.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json");case 3:return i=n.v,n.n=4,i.json();case 4:this.subscriptionConfig=n.v,n.n=6;break;case 5:n.p=5,r=n.v,this.showNotification("Error loading configurations: "+r.message,"error");case 6:return n.a(2)}},n,this,[[0,5]])})),function(){return a.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var n=this;document.getElementById("saveDeltaTimer").addEventListener("click",function(){n.saveDeltaTimer()}),document.getElementById("saveSubscription").addEventListener("click",function(){n.saveSubscription()}),document.getElementById("addPath").addEventListener("click",function(){n.addPathItem()}),document.getElementById("subscriptionJson").addEventListener("input",function(){n.syncFromJson()}),document.getElementById("context").addEventListener("input",function(){n.updateJsonFromForm()})}},{key:"updateUI",value:function(){var n=this;this.deltaTimerConfig&&this.deltaTimerConfig.deltaTimer&&(document.getElementById("deltaTimer").value=this.deltaTimerConfig.deltaTimer),this.subscriptionConfig&&(document.getElementById("context").value=this.subscriptionConfig.context||"*",document.getElementById("pathsList").innerHTML="",this.subscriptionConfig.subscribe&&Array.isArray(this.subscriptionConfig.subscribe)&&this.subscriptionConfig.subscribe.forEach(function(t){n.addPathItem(t.path)}),document.getElementById("subscriptionJson").value=JSON.stringify(this.subscriptionConfig,null,2))}},{key:"addPathItem",value:function(){var n=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=document.getElementById("pathsList"),i=document.createElement("div");i.className="path-item",i.innerHTML='\n            <input type="text" value="'.concat(t,'" placeholder="navigation.position" class="path-input">\n            <button type="button" class="btn btn-danger" onclick="this.parentElement.remove(); window.dataConnectorConfig.updateJsonFromForm();">Remove</button>\n        '),i.querySelector(".path-input").addEventListener("input",function(){n.updateJsonFromForm()}),e.appendChild(i),this.updateJsonFromForm()}},{key:"updateJsonFromForm",value:function(){var n=document.getElementById("context").value||"*",t=document.querySelectorAll(".path-input"),e={context:n,subscribe:Array.from(t).map(function(n){return{path:n.value}}).filter(function(n){return""!==n.path.trim()})};document.getElementById("subscriptionJson").value=JSON.stringify(e,null,2)}},{key:"syncFromJson",value:function(){var n=this;try{var t=document.getElementById("subscriptionJson").value,e=JSON.parse(t);document.getElementById("context").value=e.context||"*",document.getElementById("pathsList").innerHTML="",e.subscribe&&Array.isArray(e.subscribe)&&e.subscribe.forEach(function(t){n.addPathItem(t.path||"")})}catch(n){console.warn("Invalid JSON in editor:",n.message)}}},{key:"saveDeltaTimer",value:(s=r(t().m(function n(){var e,i,r;return t().w(function(n){for(;;)switch(n.p=n.n){case 0:if(e=parseInt(document.getElementById("deltaTimer").value),!(isNaN(e)||e<100||e>1e4)){n.n=1;break}return this.showNotification("Delta timer must be between 100 and 10000 milliseconds","error"),n.a(2);case 1:return i={deltaTimer:e},n.p=2,n.n=3,fetch("/plugins/signalk-data-connector/config/delta_timer.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 3:if(!n.v.ok){n.n=4;break}this.deltaTimerConfig=i,this.showNotification("Delta timer configuration saved successfully!","success"),this.updateStatus(),n.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:n.n=7;break;case 6:n.p=6,r=n.v,this.showNotification("Error saving delta timer: "+r.message,"error");case 7:return n.a(2)}},n,this,[[2,6]])})),function(){return s.apply(this,arguments)})},{key:"saveSubscription",value:(i=r(t().m(function n(){var e,i,r;return t().w(function(n){for(;;)switch(n.p=n.n){case 0:if(n.p=0,e=document.getElementById("subscriptionJson").value,(i=JSON.parse(e)).context){n.n=1;break}throw new Error("Context is required");case 1:if(i.subscribe&&Array.isArray(i.subscribe)){n.n=2;break}throw new Error("Subscribe array is required");case 2:return n.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)});case 3:if(!n.v.ok){n.n=4;break}this.subscriptionConfig=i,this.showNotification("Subscription configuration saved successfully!","success"),this.updateStatus(),n.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:n.n=7;break;case 6:n.p=6,r=n.v,this.showNotification("Error saving subscription: "+r.message,"error");case 7:return n.a(2)}},n,this,[[0,6]])})),function(){return i.apply(this,arguments)})},{key:"updateStatus",value:function(){var n=document.getElementById("status"),t="<h4>Configuration Status</h4>";if(this.deltaTimerConfig?t+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> '.concat(this.deltaTimerConfig.deltaTimer,'ms\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n            '):t+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ',this.subscriptionConfig&&this.subscriptionConfig.subscribe){var e=this.subscriptionConfig.subscribe.length;t+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> '.concat(e,' path(s) configured\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n                <div class="status-details">\n                    <strong>Context:</strong> ').concat(this.subscriptionConfig.context,"<br>\n                    <strong>Paths:</strong> ").concat(this.subscriptionConfig.subscribe.map(function(n){return n.path}).join(", "),"\n                </div>\n            ")}else t+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ';n.innerHTML=t}},{key:"showServerModeUI",value:function(){document.querySelector(".container").innerHTML='\n            <div class="config-section">\n                <div class="card server-mode-card">\n                    <div class="card-header">\n                        <h2>üñ•Ô∏è Server Mode Active</h2>\n                        <p>This plugin is running in Server Mode</p>\n                    </div>\n                    <div class="card-content">\n                        <div class="server-mode-info">\n                            <h3>Server Mode Information</h3>\n                            <p>This SignalK Data Connector instance is configured to <strong>receive encrypted data</strong> from client devices.</p>\n                            \n                            <div class="info-grid">\n                                <div class="info-item">\n                                    <h4>üîß Configuration</h4>\n                                    <p>Server mode configuration is managed through the SignalK server plugin settings. No additional webapp configuration is required.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üì° Network</h4>\n                                    <p>The server is listening for encrypted UDP data transmissions from client devices on the configured port.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üîê Security</h4>\n                                    <p>All incoming data is automatically decrypted using the configured secret key and integrated into the SignalK data stream.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üìä Data Flow</h4>\n                                    <p><strong>Client Devices ‚Üí Server (This Instance) ‚Üí SignalK Data Stream</strong></p>\n                                </div>\n                            </div>\n\n                            <div class="server-status">\n                                <h4>Current Status</h4>\n                                <div class="status-indicator success">‚úì Server is active and listening for client connections</div>\n                            </div>\n\n                            <div class="configuration-note">\n                                <h4>üí° Need to Configure?</h4>\n                                <p>To modify server settings (UDP port, encryption key, etc.), use the SignalK server\'s plugin configuration interface:</p>\n                                <ol>\n                                    <li>Go to SignalK Admin Panel</li>\n                                    <li>Navigate to Plugin Config</li>\n                                    <li>Find "Signal K Data Connector"</li>\n                                    <li>Adjust settings as needed</li>\n                                </ol>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}},{key:"showNotification",value:function(n){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",e=document.getElementById("notification");e.textContent=n,e.className="notification ".concat(t," show"),setTimeout(function(){e.classList.remove("show")},4e3)}}],e&&o(n.prototype,e),Object.defineProperty(n,"prototype",{writable:!1}),n;var n,e,i,s,a,c,u}();document.addEventListener("DOMContentLoaded",function(){window.dataConnectorConfig=new a})})();
//# sourceMappingURL=main.97bf5cc6884a774dc7b9.js.map
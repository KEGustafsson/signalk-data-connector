/*! For license information please see main.71911a9dcbb127adda9a.js.LICENSE.txt */
(()=>{"use strict";function t(n){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},t(n)}function n(){var t,s,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",a=i.toStringTag||"@@toStringTag";function o(n,i,r,a){var o=i&&i.prototype instanceof u?i:u,l=Object.create(o.prototype);return e(l,"_invoke",function(n,e,i){var r,a,o,u=0,l=i||[],d=!1,v={p:0,n:0,v:t,a:p,f:p.bind(t,4),d:function(n,e){return r=n,a=0,o=t,v.n=e,c}};function p(n,e){for(a=n,o=e,s=0;!d&&u&&!i&&s<l.length;s++){var i,r=l[s],p=v.p,f=r[2];n>3?(i=f===e)&&(o=r[(a=r[4])?5:(a=3,3)],r[4]=r[5]=t):r[0]<=p&&((i=n<2&&p<r[1])?(a=0,v.v=e,v.n=r[1]):p<f&&(i=n<3||r[0]>e||e>f)&&(r[4]=n,r[5]=e,v.n=f,a=0))}if(i||n>1)return c;throw d=!0,e}return function(i,l,f){if(u>1)throw TypeError("Generator is already running");for(d&&1===l&&p(l,f),a=l,o=f;(s=a<2?t:o)||!d;){r||(a?a<3?(a>1&&(v.n=-1),p(a,o)):v.n=o:v.v=o);try{if(u=2,r){if(a||(i="next"),s=r[i]){if(!(s=s.call(r,o)))throw TypeError("iterator result is not an object");if(!s.done)return s;o=s.value,a<2&&(a=0)}else 1===a&&(s=r.return)&&s.call(r),a<2&&(o=TypeError("The iterator does not provide a '"+i+"' method"),a=1);r=t}else if((s=(d=v.n<0)?o:n.call(e,v))!==c)break}catch(n){r=t,a=1,o=n}finally{u=1}}return{value:s,done:d}}}(n,r,a),!0),l}var c={};function u(){}function l(){}function d(){}s=Object.getPrototypeOf;var v=[][r]?s(s([][r]())):(e(s={},r,function(){return this}),s),p=d.prototype=u.prototype=Object.create(v);function f(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,e(t,a,"GeneratorFunction")),t.prototype=Object.create(p),t}return l.prototype=d,e(p,"constructor",d),e(d,"constructor",l),l.displayName="GeneratorFunction",e(d,a,"GeneratorFunction"),e(p),e(p,a,"Generator"),e(p,r,function(){return this}),e(p,"toString",function(){return"[object Generator]"}),(n=function(){return{w:o,m:f}})()}function e(t,n,s,i){var r=Object.defineProperty;try{r({},"",{})}catch(t){r=0}e=function(t,n,s,i){function a(n,s){e(t,n,function(t){return this._invoke(n,s,t)})}n?r?r(t,n,{value:s,enumerable:!i,configurable:!i,writable:!i}):t[n]=s:(a("next",0),a("throw",1),a("return",2))},e(t,n,s,i)}function s(t,n,e,s,i,r,a){try{var o=t[r](a),c=o.value}catch(t){return void e(t)}o.done?n(c):Promise.resolve(c).then(s,i)}function i(t){return function(){var n=this,e=arguments;return new Promise(function(i,r){var a=t.apply(n,e);function o(t){s(a,i,r,o,c,"next",t)}function c(t){s(a,i,r,o,c,"throw",t)}o(void 0)})}}function r(t,n){for(var e=0;e<n.length;e++){var s=n[e];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,a(s.key),s)}}function a(n){var e=function(n){if("object"!=t(n)||!n)return n;var e=n[Symbol.toPrimitive];if(void 0!==e){var s=e.call(n,"string");if("object"!=t(s))return s;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(n)}(n);return"symbol"==t(e)?e:e+""}var o=function(){return t=function t(){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,t),this.deltaTimerConfig=null,this.subscriptionConfig=null,this.isServerMode=!1,this.metricsInterval=null,this.init()},e=[{key:"init",value:(l=i(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,this.checkServerMode();case 1:if(!this.isServerMode){t.n=3;break}return this.showServerModeUI(),t.n=2,this.loadMetrics();case 2:this.startMetricsRefresh(),t.n=6;break;case 3:return t.n=4,this.loadConfigurations();case 4:return this.setupEventListeners(),this.updateUI(),this.updateStatus(),t.n=5,this.loadMetrics();case 5:this.startMetricsRefresh();case 6:t.n=8;break;case 7:t.p=7,e=t.v,console.error("Initialization error:",e),this.showNotification("Failed to initialize application: "+e.message,"error");case 8:return t.a(2)}},t,this,[[0,7]])})),function(){return l.apply(this,arguments)})},{key:"checkServerMode",value:(u=i(n().m(function t(){var e;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:e=t.v,this.isServerMode=!e.ok&&(404===e.status||405===e.status),t.n=3;break;case 2:t.p=2,t.v,this.isServerMode=!0;case 3:return t.a(2)}},t,this,[[0,2]])})),function(){return u.apply(this,arguments)})},{key:"loadConfigurations",value:(c=i(n().m(function t(){var e,s,i;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/config/delta_timer.json");case 1:return e=t.v,t.n=2,e.json();case 2:return this.deltaTimerConfig=t.v,t.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json");case 3:return s=t.v,t.n=4,s.json();case 4:this.subscriptionConfig=t.v,t.n=6;break;case 5:t.p=5,i=t.v,this.showNotification("Error loading configurations: "+i.message,"error");case 6:return t.a(2)}},t,this,[[0,5]])})),function(){return c.apply(this,arguments)})},{key:"setupEventListeners",value:function(){var t=this;document.getElementById("saveDeltaTimer").addEventListener("click",function(){t.saveDeltaTimer()}),document.getElementById("saveSubscription").addEventListener("click",function(){t.saveSubscription()}),document.getElementById("addPath").addEventListener("click",function(){t.addPathItem()}),document.getElementById("subscriptionJson").addEventListener("input",function(){t.syncFromJson()}),document.getElementById("context").addEventListener("input",function(){t.updateJsonFromForm()})}},{key:"updateUI",value:function(){var t=this;this.deltaTimerConfig&&this.deltaTimerConfig.deltaTimer&&(document.getElementById("deltaTimer").value=this.deltaTimerConfig.deltaTimer),this.subscriptionConfig&&(document.getElementById("context").value=this.subscriptionConfig.context||"*",document.getElementById("pathsList").innerHTML="",this.subscriptionConfig.subscribe&&Array.isArray(this.subscriptionConfig.subscribe)&&this.subscriptionConfig.subscribe.forEach(function(n){t.addPathItem(n.path)}),document.getElementById("subscriptionJson").value=JSON.stringify(this.subscriptionConfig,null,2))}},{key:"addPathItem",value:function(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",e=document.getElementById("pathsList"),s=document.createElement("div");s.className="path-item";var i=document.createElement("input");i.type="text",i.value=n,i.placeholder="navigation.position",i.className="path-input";var r=document.createElement("button");r.type="button",r.className="btn btn-danger",r.textContent="Remove",i.addEventListener("input",function(){t.updateJsonFromForm()}),r.addEventListener("click",function(){s.remove(),t.updateJsonFromForm()}),s.appendChild(i),s.appendChild(r),e.appendChild(s),this.updateJsonFromForm()}},{key:"updateJsonFromForm",value:function(){var t=document.getElementById("context").value||"*",n=document.querySelectorAll(".path-input"),e={context:t,subscribe:Array.from(n).map(function(t){return{path:t.value}}).filter(function(t){return""!==t.path.trim()})};document.getElementById("subscriptionJson").value=JSON.stringify(e,null,2)}},{key:"syncFromJson",value:function(){var t=this;try{var n=document.getElementById("subscriptionJson").value,e=JSON.parse(n);document.getElementById("context").value=e.context||"*",document.getElementById("pathsList").innerHTML="",e.subscribe&&Array.isArray(e.subscribe)&&e.subscribe.forEach(function(n){t.addPathItem(n.path||"")})}catch(t){console.warn("Invalid JSON in editor:",t.message)}}},{key:"saveDeltaTimer",value:(o=i(n().m(function t(){var e,s,i;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(e=parseInt(document.getElementById("deltaTimer").value),!(isNaN(e)||e<100||e>1e4)){t.n=1;break}return this.showNotification("Delta timer must be between ".concat(100," and ").concat(1e4," milliseconds"),"error"),t.a(2);case 1:return s={deltaTimer:e},t.p=2,t.n=3,fetch("/plugins/signalk-data-connector/config/delta_timer.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 3:if(!t.v.ok){t.n=4;break}this.deltaTimerConfig=s,this.showNotification("Delta timer configuration saved successfully!","success"),this.updateStatus(),t.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:t.n=7;break;case 6:t.p=6,i=t.v,this.showNotification("Error saving delta timer: "+i.message,"error");case 7:return t.a(2)}},t,this,[[2,6]])})),function(){return o.apply(this,arguments)})},{key:"saveSubscription",value:(a=i(n().m(function t(){var e,s,i;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:if(t.p=0,e=document.getElementById("subscriptionJson").value,(s=JSON.parse(e)).context){t.n=1;break}throw new Error("Context is required");case 1:if(s.subscribe&&Array.isArray(s.subscribe)){t.n=2;break}throw new Error("Subscribe array is required");case 2:return t.n=3,fetch("/plugins/signalk-data-connector/config/subscription.json",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)});case 3:if(!t.v.ok){t.n=4;break}this.subscriptionConfig=s,this.showNotification("Subscription configuration saved successfully!","success"),this.updateStatus(),t.n=5;break;case 4:throw new Error("Failed to save configuration");case 5:t.n=7;break;case 6:t.p=6,i=t.v,this.showNotification("Error saving subscription: "+i.message,"error");case 7:return t.a(2)}},t,this,[[0,6]])})),function(){return a.apply(this,arguments)})},{key:"loadMetrics",value:(s=i(n().m(function t(){var e,s,i;return n().w(function(t){for(;;)switch(t.p=t.n){case 0:return t.p=0,t.n=1,fetch("/plugins/signalk-data-connector/metrics");case 1:if(!(e=t.v).ok){t.n=3;break}return t.n=2,e.json();case 2:s=t.v,this.updateMetricsDisplay(s);case 3:t.n=5;break;case 4:t.p=4,i=t.v,console.error("Error loading metrics:",i.message);case 5:return t.a(2)}},t,this,[[0,4]])})),function(){return s.apply(this,arguments)})},{key:"startMetricsRefresh",value:function(){var t=this;this.metricsInterval&&clearInterval(this.metricsInterval),this.metricsInterval=setInterval(function(){t.loadMetrics()},5e3)}},{key:"updateMetricsDisplay",value:function(t){var n=document.getElementById("metrics");if(n){var e=t.stats.udpSendErrors>0||t.stats.compressionErrors>0||t.stats.encryptionErrors>0||t.stats.subscriptionErrors>0,s='\n      <h4>üìä Performance Metrics</h4>\n      <div class="metrics-grid">\n        <div class="metric-item">\n          <div class="metric-label">Uptime</div>\n          <div class="metric-value">'.concat(t.uptime.formatted,'</div>\n        </div>\n        <div class="metric-item">\n          <div class="metric-label">Mode</div>\n          <div class="metric-value">').concat("server"===t.mode?"üñ•Ô∏è Server":"üì± Client",'</div>\n        </div>\n        <div class="metric-item ').concat(t.status.readyToSend?"success":"error",'">\n          <div class="metric-label">Status</div>\n          <div class="metric-value">').concat(t.status.readyToSend?"‚úì Ready":"‚úó Not Ready",'</div>\n        </div>\n        <div class="metric-item">\n          <div class="metric-label">Buffered Deltas</div>\n          <div class="metric-value">').concat(t.status.deltasBuffered,'</div>\n        </div>\n      </div>\n\n      <div class="metrics-stats">\n        <h5>Transmission Statistics</h5>\n        <div class="stats-grid">\n          <div class="stat-item">\n            <span class="stat-label">Deltas Sent:</span>\n            <span class="stat-value">').concat(t.stats.deltasSent.toLocaleString(),'</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">Deltas Received:</span>\n            <span class="stat-value">').concat(t.stats.deltasReceived.toLocaleString(),'</span>\n          </div>\n          <div class="stat-item ').concat(t.stats.udpSendErrors>0?"error":"",'">\n            <span class="stat-label">UDP Send Errors:</span>\n            <span class="stat-value">').concat(t.stats.udpSendErrors,'</span>\n          </div>\n          <div class="stat-item">\n            <span class="stat-label">UDP Retries:</span>\n            <span class="stat-value">').concat(t.stats.udpRetries,'</span>\n          </div>\n          <div class="stat-item ').concat(t.stats.compressionErrors>0?"error":"",'">\n            <span class="stat-label">Compression Errors:</span>\n            <span class="stat-value">').concat(t.stats.compressionErrors,'</span>\n          </div>\n          <div class="stat-item ').concat(t.stats.encryptionErrors>0?"error":"",'">\n            <span class="stat-label">Encryption Errors:</span>\n            <span class="stat-value">').concat(t.stats.encryptionErrors,'</span>\n          </div>\n          <div class="stat-item ').concat(t.stats.subscriptionErrors>0?"error":"",'">\n            <span class="stat-label">Subscription Errors:</span>\n            <span class="stat-value">').concat(t.stats.subscriptionErrors,"</span>\n          </div>\n        </div>\n      </div>\n    ");if(t.lastError){var i=t.lastError.timeAgo,r=i<6e4?"".concat(Math.floor(i/1e3),"s ago"):"".concat(Math.floor(i/6e4),"m ago");s+='\n        <div class="metrics-error">\n          <h5>‚ö†Ô∏è Last Error</h5>\n          <div class="error-message">'.concat(this.escapeHtml(t.lastError.message),'</div>\n          <div class="error-time">Occurred ').concat(r,"</div>\n        </div>\n      ")}else e||(s+='\n        <div class="metrics-success">\n          <div class="success-message">‚úì No errors detected</div>\n        </div>\n      ');n.innerHTML=s}}},{key:"escapeHtml",value:function(t){var n=document.createElement("div");return n.textContent=t,n.innerHTML}},{key:"updateStatus",value:function(){var t=document.getElementById("status"),n="<h4>Configuration Status</h4>";if(this.deltaTimerConfig?n+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> '.concat(this.deltaTimerConfig.deltaTimer,'ms\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n            '):n+='\n                <div class="status-item">\n                    <strong>Delta Timer:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ',this.subscriptionConfig&&this.subscriptionConfig.subscribe){var e=this.subscriptionConfig.subscribe.length;n+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> '.concat(e,' path(s) configured\n                    <span class="status-indicator success">‚úì Configured</span>\n                </div>\n                <div class="status-details">\n                    <strong>Context:</strong> ').concat(this.subscriptionConfig.context,"<br>\n                    <strong>Paths:</strong> ").concat(this.subscriptionConfig.subscribe.map(function(t){return t.path}).join(", "),"\n                </div>\n            ")}else n+='\n                <div class="status-item">\n                    <strong>Subscriptions:</strong> \n                    <span class="status-indicator warning">‚ö† Not configured</span>\n                </div>\n            ';t.innerHTML=n}},{key:"showServerModeUI",value:function(){document.querySelector(".container").innerHTML='\n            <div class="config-section">\n                <div class="card server-mode-card">\n                    <div class="card-header">\n                        <h2>üñ•Ô∏è Server Mode Active</h2>\n                        <p>This plugin is running in Server Mode</p>\n                    </div>\n                    <div class="card-content">\n                        <div class="server-mode-info">\n                            <h3>Server Mode Information</h3>\n                            <p>This SignalK Data Connector instance is configured to <strong>receive encrypted data</strong> from client devices.</p>\n                            \n                            <div class="info-grid">\n                                <div class="info-item">\n                                    <h4>üîß Configuration</h4>\n                                    <p>Server mode configuration is managed through the SignalK server plugin settings. No additional webapp configuration is required.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üì° Network</h4>\n                                    <p>The server is listening for encrypted UDP data transmissions from client devices on the configured port.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üîê Security</h4>\n                                    <p>All incoming data is automatically decrypted using the configured secret key and integrated into the SignalK data stream.</p>\n                                </div>\n                                \n                                <div class="info-item">\n                                    <h4>üìä Data Flow</h4>\n                                    <p><strong>Client Devices ‚Üí Server (This Instance) ‚Üí SignalK Data Stream</strong></p>\n                                </div>\n                            </div>\n\n                            <div class="server-status">\n                                <h4>Current Status</h4>\n                                <div class="status-indicator success">‚úì Server is active and listening for client connections</div>\n                            </div>\n\n                            <div id="metrics" class="metrics-section"></div>\n\n                            <div class="configuration-note">\n                                <h4>üí° Need to Configure?</h4>\n                                <p>To modify server settings (UDP port, encryption key, etc.), use the SignalK server\'s plugin configuration interface:</p>\n                                <ol>\n                                    <li>Go to SignalK Admin Panel</li>\n                                    <li>Navigate to Plugin Config</li>\n                                    <li>Find "Signal K Data Connector"</li>\n                                    <li>Adjust settings as needed</li>\n                                </ol>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        '}},{key:"showNotification",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"success",e=document.getElementById("notification");e.textContent=t,e.className="notification ".concat(n," show"),setTimeout(function(){e.classList.remove("show")},4e3)}}],e&&r(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,s,a,o,c,u,l}();document.addEventListener("DOMContentLoaded",function(){window.dataConnectorConfig=new o})})();
//# sourceMappingURL=main.71911a9dcbb127adda9a.js.map